╔══════════════════════════════════════════════════════════════════════════════╗
║                    DOMAIN BACKLINK ANALYZER - ARCHITECTURE                   ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                           USER INTERACTION LAYER                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
                          ┌───────────────────────┐
                          │  domain_analyzer.py   │  ◄── Main CLI Script
                          │   (Orchestrator)      │
                          └───────────────────────┘
                                      │
                      ┌───────────────┼───────────────┐
                      ▼               ▼               ▼
              ┌───────────┐   ┌───────────┐   ┌───────────┐
              │  Config   │   │  Logger   │   │ CLI Args  │
              │ (.env)    │   │  Setup    │   │  Parser   │
              └───────────┘   └───────────┘   └───────────┘

═══════════════════════════════════════════════════════════════════════════════
                              PROCESSING PIPELINE
═══════════════════════════════════════════════════════════════════════════════

╔═══════════════════════════════════════════════════════════════════════════╗
║  STAGE 1: BACKLINK COLLECTION                                             ║
╚═══════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────┐
    │                    Keys.so API Client                        │
    │  ┌──────────────────────────────────────────────────────┐   │
    │  │  get_backlinks(domain, limit)                        │   │
    │  │  ├─ HTTP Request to Keys.so API                      │   │
    │  │  ├─ Pagination handling                              │   │
    │  │  └─ Returns: List[Dict] with backlink data          │   │
    │  └──────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────┘
                                │
                                ▼
                    ┌─────────────────────┐
                    │  Backlinks List     │
                    │  [url, anchor, ...]  │
                    └─────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════╗
║  STAGE 2: DOMAIN EXTRACTION                                               ║
╚═══════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────┐
    │                    Domain Extractor                          │
    │  ┌──────────────────────────────────────────────────────┐   │
    │  │  extract_unique_domains(backlinks)                   │   │
    │  │  ├─ Parse URLs using tldextract                      │   │
    │  │  ├─ Extract domain names                             │   │
    │  │  ├─ Deduplicate (Set)                                │   │
    │  │  └─ Returns: List[str] unique domains               │   │
    │  └──────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────┘
                                │
                                ▼
                    ┌─────────────────────┐
                    │  Unique Domains     │
                    │  [example.com, ...]  │
                    └─────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════╗
║  STAGE 3: AVAILABILITY CHECK                                              ║
╚═══════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────┐
    │              Domain Availability Checker                     │
    │  ┌──────────────────────────────────────────────────────┐   │
    │  │  check_domains(domains)                              │   │
    │  │  ├─ Parallel processing (asyncio)                    │   │
    │  │  ├─ Try RDAP first (fast, free)                      │   │
    │  │  ├─ Fallback to WHOIS API if RDAP fails             │   │
    │  │  ├─ Rate limiting & retry logic                      │   │
    │  │  └─ Returns: List[AvailabilityResult]               │   │
    │  └──────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────┘
                                │
                                ▼
          ┌─────────────────────────────────────────┐
          │     Availability Results                 │
          │  {domain: REGISTERED/AVAILABLE/ERROR}    │
          └─────────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════╗
║  STAGE 4: FILTERING & METRICS                                             ║
╚═══════════════════════════════════════════════════════════════════════════╝

    ┌─────────────────────────────────────────────────────────────┐
    │              Domain Filtering Pipeline                       │
    │  ┌──────────────────────────────────────────────────────┐   │
    │  │  process_domains(domains, availability, backlinks)   │   │
    │  │                                                        │   │
    │  │  ┌──────────────────────────────────────────────┐    │   │
    │  │  │  1. Load Configuration                       │    │   │
    │  │  │     ├─ spam_phrases.txt                      │    │   │
    │  │  │     └─ excluded_domains.txt                  │    │   │
    │  │  └──────────────────────────────────────────────┘    │   │
    │  │                    ▼                                   │   │
    │  │  ┌──────────────────────────────────────────────┐    │   │
    │  │  │  2. Filter Domains                           │    │   │
    │  │  │     ├─ Check availability (registered?)      │    │   │
    │  │  │     ├─ Check exclusion list                  │    │   │
    │  │  │     └─ Check spam in anchors                 │    │   │
    │  │  └──────────────────────────────────────────────┘    │   │
    │  │                    ▼                                   │   │
    │  │  ┌──────────────────────────────────────────────┐    │   │
    │  │  │  3. Fetch Metrics (optional)                 │    │   │
    │  │  │     ├─ DR (Domain Rating)                    │    │   │
    │  │  │     ├─ UR (URL Rating)                       │    │   │
    │  │  │     ├─ Organic traffic                       │    │   │
    │  │  │     └─ Total backlinks                       │    │   │
    │  │  └──────────────────────────────────────────────┘    │   │
    │  │                    ▼                                   │   │
    │  │  Returns: List[FilteredDomain]                        │   │
    │  └──────────────────────────────────────────────────────┘   │
    └─────────────────────────────────────────────────────────────┘
                                │
                                ▼
           ┌────────────────────────────────────┐
           │    Filtered Domain Objects         │
           │  [FilteredDomain(domain, dr, ...)] │
           └────────────────────────────────────┘

╔═══════════════════════════════════════════════════════════════════════════╗
║  STAGE 5: EXPORT                                                          ║
╚═══════════════════════════════════════════════════════════════════════════╝

                ┌──────────────────────┐
                │  Export Format       │
                │  Selection           │
                └──────────────────────┘
                         │
         ┌───────────────┼───────────────┐
         ▼               ▼               ▼
    ┌────────┐     ┌─────────┐    ┌─────────┐
    │  CSV   │     │  Excel  │    │  JSON   │
    │Exporter│     │Exporter │    │Exporter │
    └────────┘     └─────────┘    └─────────┘
         │               │               │
         ▼               ▼               ▼
    ┌────────┐     ┌─────────┐    ┌─────────┐
    │  .csv  │     │  .xlsx  │    │  .json  │
    │ Simple │     │2 Sheets │    │  With   │
    │ Table  │     │+Format  │    │Metadata │
    └────────┘     └─────────┘    └─────────┘

═══════════════════════════════════════════════════════════════════════════════
                              DATA MODELS
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                           FilteredDomain                                     │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  Attributes:                                                           │  │
│  │  • domain: str                                                         │  │
│  │  • dr: Optional[int]          # Domain Rating                         │  │
│  │  • ur: Optional[int]          # URL Rating                            │  │
│  │  • backlink_count: int                                                │  │
│  │  • total_backlinks: Optional[int]                                     │  │
│  │  • referring_domains: Optional[int]                                   │  │
│  │  • organic_traffic: Optional[int]                                     │  │
│  │  • is_registered: bool                                                │  │
│  │  • is_spam: bool                                                      │  │
│  │  • is_excluded: bool                                                  │  │
│  │  • spam_anchor_examples: List[str]                                    │  │
│  │  • checked_at: Optional[datetime]                                     │  │
│  │                                                                        │  │
│  │  Properties:                                                           │  │
│  │  • is_valid → bool  (registered AND not spam AND not excluded)       │  │
│  │                                                                        │  │
│  │  Methods:                                                              │  │
│  │  • to_dict() → dict                                                   │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                         AvailabilityResult                                   │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │  • domain: str                                                         │  │
│  │  • status: DomainStatus  (REGISTERED/AVAILABLE/UNKNOWN/ERROR)        │  │
│  │  • checked_via: str      (rdap/whois/error)                          │  │
│  │  • error: Optional[str]                                               │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                           CONFIGURATION FLOW
═══════════════════════════════════════════════════════════════════════════════

┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│ CLI Args     │ ──> │ Environment  │ ──> │  Defaults    │
│ (highest)    │     │ Variables    │     │  (lowest)    │
└──────────────┘     └──────────────┘     └──────────────┘
      │                    │                     │
      └────────────────────┴─────────────────────┘
                           ▼
                    ┌──────────────┐
                    │   Config     │
                    │   Objects    │
                    └──────────────┘

═══════════════════════════════════════════════════════════════════════════════
                             PARALLEL PROCESSING
═══════════════════════════════════════════════════════════════════════════════

   Domain List [1000 domains]
            │
            ▼
   ┌─────────────────────┐
   │  asyncio.gather()   │
   │  max_workers=20     │
   └─────────────────────┘
            │
   ┌────────┴─────────┐
   ▼        ▼         ▼
 Worker  Worker ... Worker
  (1)     (2)       (20)
   │        │         │
   └────────┴─────────┘
            ▼
     [Results aggregated]

═══════════════════════════════════════════════════════════════════════════════
                              LOGGING SYSTEM
═══════════════════════════════════════════════════════════════════════════════

┌──────────────────────────────────────┐
│          Logger Setup                │
│  ┌────────────────────────────────┐  │
│  │  Level: INFO/DEBUG             │  │
│  │  Format: timestamp + message   │  │
│  └────────────────────────────────┘  │
│              │                        │
│     ┌────────┴────────┐              │
│     ▼                 ▼              │
│ ┌────────┐      ┌──────────┐        │
│ │Console │      │   File   │        │
│ │Handler │      │ Handler  │        │
│ └────────┘      └──────────┘        │
│     │                 │              │
│  stdout          logs/*.log          │
└──────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════

Key Features:
✓ Modular architecture
✓ Async/await for I/O operations
✓ Parallel processing with rate limiting
✓ Multiple export formats
✓ Comprehensive error handling
✓ Configurable at multiple levels
✓ Extensible design

═══════════════════════════════════════════════════════════════════════════════
